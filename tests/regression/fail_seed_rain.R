## This was a bug that affected us up to version
## richfitz/tree@1230d606039ef4eede10235f8fe4e0536c7699f8
## It was caused by extremely large rates of change on variables that
## had values that were 0 (-Inf in log-space).
library(tree)
disturbance <- 7.5
slope <- 3.0

p0 <- new(Parameters)
p0$set_parameters(list(patch_area=1.0))
p0$set_control_parameters(fast_control())
p0$disturbance <- new(Disturbance, disturbance)

s <- new(Strategy, list(c_r1=0.5,
                        c_r2=0,
                        B4=slope))

## These parameters were pulled from the case in which this issue was
## found.
sys <- list()
sys[["traits"]] <- cbind(lma=c(0.1978791, 0.181173676138088, 0.183310899975171, 0.116519257093388, 0.204333343737523, 0.155924526548134, 0.0230693652603907, 0.000141280937451138, 9.29972762342145))
sys[["seed_rain"]] <- c(583.235253031473, 16.4516856577287, 10.4711573384958, 10.5952780670126, 0.001, 0.001, 0.001, 0.001, 0.00)
sys[["times"]] <- list()
sys[["times"]][[1]]<- c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.000324140625, 0.0003393994140625, 0.000354658203125, 0.0003699169921875, 0.00038517578125, 0.0004004345703125, 0.000415693359375, 0.0004309521484375, 0.0004614697265625, 0.0004919873046875, 0.0005225048828125, 0.0005530224609375, 0.0005835400390625, 0.000598798828125, 0.0006140576171875, 0.0006445751953125, 0.0006750927734375, 0.0007056103515625, 0.0007361279296875, 0.0007666455078125, 0.0007971630859375, 0.0008276806640625, 0.0008581982421875, 0.0008887158203125, 0.0009192333984375, 0.0009497509765625, 0.0009802685546875, 0.0010107861328125, 0.0010413037109375, 0.0010718212890625, 0.0011023388671875, 0.0011633740234375, 0.0011938916015625, 0.0012244091796875, 0.0012854443359375, 0.0013464794921875, 0.0014075146484375, 0.0014685498046875, 0.0015295849609375, 0.0015906201171875, 0.0016516552734375, 0.0017126904296875, 0.0017737255859375, 0.0018347607421875, 0.0018957958984375, 0.0019568310546875, 0.0020178662109375, 0.0020789013671875, 0.0021399365234375, 0.0022009716796875, 0.0023230419921875, 0.0023840771484375, 0.0024451123046875, 0.0025061474609375, 0.0025671826171875, 0.0026282177734375, 0.0026892529296875, 0.0028113232421875, 0.0029333935546875, 0.0030554638671875, 0.0031775341796875, 0.0032996044921875, 0.0033606396484375, 0.0034216748046875, 0.0035437451171875, 0.0036047802734375, 0.0036658154296875, 0.0037878857421875, 0.0039099560546875, 0.0040320263671875, 0.0041540966796875, 0.0042761669921875, 0.0043982373046875, 0.0045203076171875, 0.0046423779296875, 0.0047644482421875,
	c(0.0048865185546875, 0.0050085888671875, 0.0051306591796875, 0.0052527294921875, 0.0053747998046875, 0.0056189404296875, 0.0058630810546875, 0.0061072216796875, 0.0062292919921875, 0.0063513623046875, 0.0065955029296875, 0.0068396435546875, 0.0070837841796875, 0.0073279248046875, 0.0075720654296875, 0.0078162060546875, 0.0080603466796875, 0.0083044873046875, 0.0085486279296875, 0.0087927685546875, 0.0090369091796875, 0.0092810498046875, 0.0095251904296875, 0.0097693310546875, 0.0102576123046875, 0.0107458935546875, 0.0112341748046875, 0.0114783154296875, 0.0117224560546875, 0.0126990185546875, 0.0131872998046875, 0.0134314404296875, 0.0136755810546875, 0.0141638623046875, 0.0146521435546875, 0.0151404248046875, 0.0156287060546875, 0.0161169873046875, 0.0166052685546875, 0.0170935498046875, 0.0175818310546875, 0.0185583935546875, 0.0195349560546875, 0.0205115185546875, 0.0209997998046875, 0.0212439404296875, 0.0214880810546875, 0.0224646435546875, 0.0234412060546875, 0.0244177685546875, 0.0253943310546875, 0.0263708935546875, 0.0268591748046875, 0.0273474560546875, 0.0293005810546875, 0.0302771435546875, 0.0312537060546875, 0.0332068310546875, 0.0351599560546875, 0.0361365185546875, 0.0371130810546875, 0.0380896435546875, 0.0390662060546875, 0.0410193310546875, 0.0429724560546875, 0.0449255810546875, 0.0459021435546875, 0.0468787060546875, 0.0507849560546875, 0.0546912060546875, 0.0566443310546875, 0.0585974560546875, 0.0625037060546875, 0.0664099560546875, 0.0683630810546875, 0.0703162060546875, 0.0742224560546875, 0.0761755810546875, 0.0781287060546875, 0.0820349560546875, 0.0859412060546875, 0.0898474560546875, 0.0937537060546875, 0.0976599560546875, 0.0996130810546875, 0.101566206054687, 0.105472456054687, 0.109378706054687, 0.113284956054687, 0.117191206054687, 0.121097456054687, 0.125003706054687, 0.132816206054687, 0.140628706054687, 0.148441206054687, 0.152347456054687, 0.156253706054687, 0.164066206054687, 0.171878706054687, 0.179691206054687, 0.187503706054687, 0.195316206054687, 0.203128706054687, 0.210941206054687, 0.218753706054687, 0.234378706054687, 0.250003706054687, 0.265628706054687, 0.281253706054687, 0.296878706054687, 0.312503706054687, 0.328128706054687, 0.343753706054687, 0.359378706054687, 0.375003706054687, 0.406253706054687, 0.437503706054687, 0.468753706054687, 0.500003706054687, 0.531253706054687, 0.562503706054687, 0.593753706054687, 0.625003706054687, 0.687503706054687, 0.750003706054687, 0.812503706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.37500370605469, 1.50000370605469, 1.75000370605469, 1.87500370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 9.50000370605469, 9.75000370605469, 9.87500370605469, 10.0000037060547, 10.1250037060547, 10.2500037060547, 10.3750037060547, 10.5000037060547, 10.5625037060547, 10.6250037060547, 10.7500037060547, 10.8750037060547, 10.9375037060547, 11.0000037060547, 11.0625037060547, 11.1250037060547, 11.1875037060547, 11.2500037060547, 11.3125037060547, 11.3750037060547, 11.4375037060547, 11.5000037060547, 11.5625037060547, 11.6250037060547, 11.7500037060547, 11.8125037060547, 11.8750037060547, 11.9375037060547, 12.0000037060547, 12.1250037060547, 12.2500037060547, 12.3750037060547, 12.5000037060547, 12.6250037060547, 12.7500037060547, 12.8750037060547, 13.0000037060547, 13.2500037060547, 13.5000037060547, 13.7500037060547, 14.0000037060547, 14.2500037060547, 14.5000037060547, 15.0000037060547, 15.2500037060547, 15.5000037060547, 16.0000037060547, 17.0000037060547, 17.5000037060547, 18.0000037060547, 18.5000037060547, 19.0000037060547, 19.5000037060547, 20.0000037060547, 21.0000037060547, 21.5000037060547, 22.0000037060547, 23.0000037060547, 23.5000037060547, 24.0000037060547, 24.5000037060547, 25.0000037060547, 26.0000037060547, 26.33))
sys[["times"]][[2]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0429724560546875, 0.0468787060546875, 0.0507849560546875, 0.0546912060546875, 0.0585974560546875, 0.0625037060546875, 0.0664099560546875, 0.0703162060546875, 0.0742224560546875, 0.0781287060546875, 0.0820349560546875, 0.0859412060546875, 0.0937537060546875, 0.0976599560546875, 0.101566206054687, 0.105472456054687, 0.107425581054687, 0.108402143554687, 0.108890424804687, 0.109134565429687, 0.109378706054687, 0.110355268554687, 0.110843549804687, 0.111331831054687, 0.113284956054687, 0.117191206054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.312503706054687, 0.375003706054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)
sys[["times"]][[3]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0468787060546875, 0.0507849560546875, 0.0546912060546875, 0.0585974560546875, 0.0625037060546875, 0.0664099560546875, 0.0703162060546875, 0.0742224560546875, 0.0781287060546875, 0.0820349560546875, 0.0859412060546875, 0.0898474560546875, 0.0918005810546875, 0.0927771435546875, 0.0932654248046875, 0.0935095654296875, 0.0937537060546875, 0.0947302685546875, 0.0957068310546875, 0.0966833935546875, 0.0971716748046875, 0.0976599560546875, 0.101566206054687, 0.109378706054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.312503706054687, 0.375003706054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)
sys[["times"]][[4]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0468787060546875, 0.0546912060546875, 0.0625037060546875, 0.0703162060546875, 0.0781287060546875, 0.0937537060546875, 0.109378706054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.296878706054687, 0.312503706054687, 0.328128706054687, 0.343753706054687, 0.359378706054687, 0.375003706054687, 0.390628706054687, 0.398441206054687, 0.402347456054687, 0.404300581054687, 0.406253706054687, 0.414066206054687, 0.417972456054687, 0.421878706054687, 0.425784956054687, 0.427738081054687, 0.429691206054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)
sys[["times"]][[5]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0468787060546875, 0.0546912060546875, 0.0625037060546875, 0.0703162060546875, 0.0781287060546875, 0.0937537060546875, 0.109378706054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.312503706054687, 0.375003706054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)
sys[["times"]][[6]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0468787060546875, 0.0546912060546875, 0.0625037060546875, 0.0703162060546875, 0.0781287060546875, 0.0937537060546875, 0.109378706054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.312503706054687, 0.375003706054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)
sys[["times"]][[7]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0468787060546875, 0.0546912060546875, 0.0625037060546875, 0.0703162060546875, 0.0781287060546875, 0.0937537060546875, 0.109378706054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.312503706054687, 0.375003706054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)
sys[["times"]][[8]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0468787060546875, 0.0546912060546875, 0.0625037060546875, 0.0703162060546875, 0.0781287060546875, 0.0937537060546875, 0.109378706054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.312503706054687, 0.375003706054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)
sys[["times"]][[9]]<-c(0, 1e-05, 2e-05, 3e-05, 4e-05, 5e-05, 6e-05, 7e-05, 8e-05, 9.52587890625e-05, 0.000110517578125, 0.0001257763671875, 0.00014103515625, 0.0001562939453125, 0.0001868115234375, 0.0002173291015625, 0.0002478466796875, 0.0002783642578125, 0.0003088818359375, 0.0003699169921875, 0.0004309521484375, 0.0004919873046875, 0.0005530224609375, 0.0006140576171875, 0.0007361279296875, 0.0008581982421875, 0.0009802685546875, 0.0011023388671875, 0.0012244091796875, 0.0014685498046875, 0.0017126904296875, 0.0019568310546875, 0.0022009716796875, 0.0024451123046875, 0.0029333935546875, 0.0034216748046875, 0.0039099560546875, 0.0043982373046875, 0.0048865185546875, 0.0058630810546875, 0.0068396435546875, 0.0078162060546875, 0.0087927685546875, 0.0097693310546875, 0.0117224560546875, 0.0136755810546875, 0.0156287060546875, 0.0175818310546875, 0.0195349560546875, 0.0234412060546875, 0.0273474560546875, 0.0312537060546875, 0.0351599560546875, 0.0390662060546875, 0.0468787060546875, 0.0546912060546875, 0.0625037060546875, 0.0703162060546875, 0.0781287060546875, 0.0937537060546875, 0.109378706054687, 0.125003706054687, 0.140628706054687, 0.156253706054687, 0.187503706054687, 0.218753706054687, 0.250003706054687, 0.281253706054687, 0.312503706054687, 0.375003706054687, 0.437503706054687, 0.500003706054687, 0.562503706054687, 0.625003706054687, 0.750003706054687, 0.875003706054687, 1.00000370605469, 1.12500370605469, 1.25000370605469, 1.50000370605469, 1.75000370605469, 2.00000370605469, 2.25000370605469, 2.50000370605469, 3.00000370605469, 3.50000370605469, 4.00000370605469, 4.50000370605469, 5.00000370605469, 6.00000370605469, 7.00000370605469, 8.00000370605469, 9.00000370605469, 10.0000037060547, 12.0000037060547, 14.0000037060547, 16.0000037060547, 18.0000037060547, 20.0000037060547, 22.0000037060547, 24.0000037060547, 26.0000037060547, 26.33)

## Emulating the run function: breaks at births function, but problem
## arises because "run" step produces NA in seed rain output.
p <- p0$copy()
for (i in seq_len(nrow(sys$traits))){
  new.strategy <- s$copy()
  new.strategy$set_parameters(as.list(sys$traits[i,]))
  p$add_strategy(new.strategy)
}
p$seed_rain <- sys$seed_rain

eps <- p0$control$parameters$schedule_default_patch_survival
schedule <- new(CohortSchedule, p$size)
schedule$max_time <- p0$disturbance$cdf(eps)
schedule$all_times <- sys[["times"]]

ebt <- new(EBT, p$copy())
ebt$cohort_schedule <- schedule$copy()
patch <- ebt$patch
for (i in 9:1) {
  patch$add_seedling(i)
}

patch[[1]]$seeds
patch[[1]][[1]]$fecundity

m <- matrix(patch$ode_values, 4)
rownames(m) <- c("height", "mortality", "fecundity", "log_density")

r <- matrix(patch$ode_rates, 4)
dimnames(r) <- dimnames(m)

ebt <- new(EBT, p$copy())
ebt$cohort_schedule <- schedule$copy()
ebt$run_next()
ebt$fitness_cohort(1)

## Then actually do the run:
## From 1230d606039ef4eede10235f8fe4e0536c7699f8 and before, this will
## fail:
p$set_control_parameters(list(schedule_verbose=TRUE,
                              schedule_eps=1e-3))
res <- build_schedule(p)
rain_out <- unname(attr(res, "seed_rain", exact=TRUE)[,"out"])

## For current versions this should be fine:
library(testthat)
expect_that(all(!is.na(rain_out)), is_true())
