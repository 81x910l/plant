#!/bin/sh
# This file will run on *both* R CMD INSTALL and R CMD build.  If (and
# only if) we are within the source directory, this adds two little
# files to the directory 'git' within the package containing the full
# sha for the current commit and the status of git.
#
# The purpose of tracking the status is that way we'll know the
# difference between a "real" copy of a version and a dirty copy that
# might include unstaged changes.  The full output of git status -s is
# included, so this can be checked for changes.
#
# If changes are made after the package is taken from git there is no
# protection of course.
#
# Won't work on Windows, but would be easy enough to get working if
# git is in the path.
mkdir -p inst/git
if [ -d ".git" ]
then
    git rev-parse HEAD > inst/git/sha
    git status -s > inst/git/status
fi
