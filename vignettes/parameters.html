<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="date" content="2016-01-18" />

<title>plant: A package for modelling forest trait ecology &amp; evolution: Modifying parameters</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">plant: A package for modelling forest trait ecology &amp; evolution: <em>Modifying parameters</em></h1>
<h4 class="date"><em>2016-01-18</em></h4>
</div>


<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plant)</code></pre>
<p>There are a large number of parameters to the physiological model, but all are changeable. The default strategy is detailed in the “physiology” vignette:</p>
<pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span><span class="kw">FF16_Strategy</span>()
<span class="kw">names</span>(s)</code></pre>
<pre><code>##  [1] &quot;lma&quot;     &quot;rho&quot;     &quot;hmat&quot;    &quot;omega&quot;   &quot;eta&quot;     &quot;theta&quot;   &quot;a_l1&quot;   
##  [8] &quot;a_l2&quot;    &quot;a_r1&quot;    &quot;a_b1&quot;    &quot;r_s&quot;     &quot;r_b&quot;     &quot;r_r&quot;     &quot;r_l&quot;    
## [15] &quot;a_y&quot;     &quot;a_bio&quot;   &quot;k_l&quot;     &quot;k_b&quot;     &quot;k_s&quot;     &quot;k_r&quot;     &quot;a_p1&quot;   
## [22] &quot;a_p2&quot;    &quot;a_f3&quot;    &quot;a_f1&quot;    &quot;a_f2&quot;    &quot;S_D&quot;     &quot;a_d0&quot;    &quot;d_I&quot;    
## [29] &quot;a_dG1&quot;   &quot;a_dG2&quot;   &quot;control&quot;</code></pre>
<p>The strategy object here is a special object of class FF16_Strategy. In contrast with most of the “reference” objects used by <code>plant</code>, this is simply a list with a class attribute. Some validation will be done on the parameters every time it is passed into the C++ bits of the model.</p>
<p>All parameters except for <code>control</code> are floating point (decimal) numbers:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unlist</span>(s[<span class="kw">names</span>(s) !=<span class="st"> &quot;control&quot;</span>])</code></pre>
<pre><code>##          lma          rho         hmat        omega          eta 
## 1.978791e-01 6.080000e+02 1.659587e+01 3.800000e-05 1.200000e+01 
##        theta         a_l1         a_l2         a_r1         a_b1 
## 2.141786e-04 5.440000e+00 3.060000e-01 7.000000e-02 1.700000e-01 
##          r_s          r_b          r_r          r_l          a_y 
## 6.598684e+00 1.319737e+01 2.170000e+02 1.984545e+02 7.000000e-01 
##        a_bio          k_l          k_b          k_s          k_r 
## 2.450000e-02 4.565855e-01 2.000000e-01 2.000000e-01 1.000000e+00 
##         a_p1         a_p2         a_f3         a_f1         a_f2 
## 1.511778e+02 2.047162e-01 1.140000e-04 1.000000e+00 5.000000e+01 
##          S_D         a_d0          d_I        a_dG1        a_dG2 
## 2.500000e-01 1.000000e-01 1.000000e-02 5.500000e+00 2.000000e+01</code></pre>
<p>All of these parameters can be directly changed. For example, we can double the leaf mass per unit leaf area (lma) value:</p>
<pre class="sourceCode r"><code class="sourceCode r">s$lma &lt;-<span class="st"> </span>s$lma *<span class="st"> </span><span class="dv">2</span></code></pre>
<p>and then from this construct a plant:</p>
<pre class="sourceCode r"><code class="sourceCode r">pl &lt;-<span class="st"> </span><span class="kw">FF16_Plant</span>(s)
pl$strategy$lma</code></pre>
<pre><code>## [1] 0.3957582</code></pre>
<p><code>lma</code> affects a few places in the model; see <a href="https://github.com/traitecoevo/plant/blob/master/src/ff16_strategy.cpp">the source code</a>, but only really for converting from leaf area to leaf mass (leaf mass being leaf area multiplied by leaf mass per leaf area). However, as a component of the leaf economic spectrum we imagine LMA as affecting a number of other components of the model.</p>
<p>We capture this through what we call a “hyper-parameterisation”; additional parameters and functions that mean that changing one parameter might affect a number of other lower-level parameters. Our default hyper-parameterisation is via the <code>FF16_hyperpar</code> function:</p>
<pre class="sourceCode r"><code class="sourceCode r">FF16_hyperpar</code></pre>
<pre><code>## function (m, s, filter = TRUE) 
## {
##     with_default &lt;- function(name, default_value = s[[name]]) {
##         rep_len(if (name %in% colnames(m)) 
##             m[, name]
##         else default_value, nrow(m))
##     }
##     lma &lt;- with_default(&quot;lma&quot;)
##     rho &lt;- with_default(&quot;rho&quot;)
##     omega &lt;- with_default(&quot;omega&quot;)
##     narea &lt;- with_default(&quot;narea&quot;, narea_0)
##     k_l &lt;- B_kl1 * (lma/lma_0)^(-B_kl2)
##     d_I &lt;- B_dI1 * (rho/rho_0)^(-B_dI2)
##     k_s &lt;- B_ks1 * (rho/rho_0)^(-B_ks2)
##     r_s &lt;- B_rs1/rho
##     r_b &lt;- B_rb1/rho
##     a_f3 &lt;- B_f1 * omega
##     assimilation_rectangular_hyperbolae &lt;- function(I, Amax, 
##         theta, QY) {
##         x &lt;- QY * I + Amax
##         (x - sqrt(x^2 - 4 * theta * QY * I * Amax))/(2 * theta)
##     }
##     approximate_annual_assimilation &lt;- function(narea, latitude) {
##         E &lt;- seq(0, 1, by = 0.02)
##         D &lt;- seq(0, 365/2, length.out = 10000)
##         I &lt;- PAR_given_solar_angle(solar_angle(D, latitude = abs(latitude)))
##         Amax &lt;- narea * B_lf1
##         theta &lt;- B_lf2
##         QY &lt;- B_lf3
##         AA &lt;- NA * E
##         for (i in seq_len(length(E))) {
##             AA[i] &lt;- 2 * trapezium(D, assimilation_rectangular_hyperbolae(k_I * 
##                 I * E[i], Amax, theta, QY))
##         }
##         if (all(diff(AA) &lt; 1e-08)) {
##             ret &lt;- c(last(AA), 0)
##             names(ret) &lt;- c(&quot;p1&quot;, &quot;p2&quot;)
##         }
##         else {
##             fit &lt;- nls(AA ~ p1 * E/(p2 + E), data.frame(E = E, 
##                 AA = AA), start = list(p1 = 100, p2 = 0.2))
##             ret &lt;- coef(fit)
##         }
##         ret
##     }
##     a_p1 &lt;- a_p2 &lt;- 0 * narea
##     if (length(narea) &gt; 0 || k_I != 0.5) {
##         i &lt;- match(narea, unique(narea))
##         y &lt;- vapply(unique(narea), approximate_annual_assimilation, 
##             numeric(2), latitude)
##         a_p1 &lt;- y[&quot;p1&quot;, i]
##         a_p2 &lt;- y[&quot;p2&quot;, i]
##     }
##     r_l &lt;- B_lf4 * narea/lma
##     extra &lt;- cbind(k_l, d_I, k_s, r_s, r_b, a_f3, a_p1, a_p2, 
##         r_l)
##     overlap &lt;- intersect(colnames(m), colnames(extra))
##     if (length(overlap) &gt; 0L) {
##         stop(&quot;Attempt to overwrite generated parameters: &quot;, paste(overlap, 
##             collapse = &quot;, &quot;))
##     }
##     if (filter) {
##         if (nrow(extra) == 0L) {
##             extra &lt;- NULL
##         }
##         else {
##             pos &lt;- diff(apply(extra, 2, range)) == 0
##             if (any(pos)) {
##                 eps &lt;- sqrt(.Machine$double.eps)
##                 x1 &lt;- extra[1, pos]
##                 x2 &lt;- unlist(s[names(x1)])
##                 drop &lt;- abs(x1 - x2) &lt; eps &amp; abs(1 - x1/x2) &lt; 
##                   eps
##                 if (any(drop)) {
##                   keep &lt;- setdiff(colnames(extra), names(drop)[drop])
##                   extra &lt;- extra[, keep, drop = FALSE]
##                 }
##             }
##         }
##     }
##     if (!is.null(extra)) {
##         m &lt;- cbind(m, extra)
##     }
##     m
## }
## &lt;environment: 0x2983540&gt;</code></pre>
<p>You will rarely need to call this function directly (see below) but note how setting of lma affects parameters <code>k_l</code>, <code>a_p1</code> and <code>r_l</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">FF16_hyperpar</span>(<span class="kw">trait_matrix</span>(<span class="fl">0.1</span>, <span class="st">&quot;lma&quot;</span>), s)</code></pre>
<pre><code>##    lma      k_l     a_p1   r_l
## p1 0.1 1.466783 151.1778 392.7</code></pre>
<p>These are: * <code>k_l</code>: Turnover rate for leaves * <code>a_p1</code>: Leaf photosynthesis per area * <code>r_l</code>: Leaf respiration per mass</p>
<p>This means that it is possible to implement different trade-offs between parameters relatively easily by modifying the hyper-parameterisation function in R, rather than having to modify the underlying physiological model in C++.</p>
<p>The <code>trait_matrix</code> function is a simple wrapper that just makes sure the trait matrix has the right format:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trait_matrix</span>(<span class="fl">0.1</span>, <span class="st">&quot;lma&quot;</span>)</code></pre>
<pre><code>##      lma
## [1,] 0.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trait_matrix</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">500</span>), <span class="st">&quot;rho&quot;</span>)</code></pre>
<pre><code>##        rho
## [1,]   0.1
## [2,] 500.0</code></pre>
<p>To make use of the hyper-parameterisation, the preferred way of setting parameters is through the utility functions <code>strategy</code> and <code>strategy_list</code>. These take a <code>Parameters</code> object:</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">FF16_Parameters</span>()</code></pre>
<p>The Parameters object mostly contains information about the patch:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(p)</code></pre>
<pre><code>##  [1] &quot;k_I&quot;                           &quot;patch_area&quot;                   
##  [3] &quot;n_patches&quot;                     &quot;disturbance_mean_interval&quot;    
##  [5] &quot;strategies&quot;                    &quot;seed_rain&quot;                    
##  [7] &quot;is_resident&quot;                   &quot;control&quot;                      
##  [9] &quot;strategy_default&quot;              &quot;cohort_schedule_max_time&quot;     
## [11] &quot;cohort_schedule_times_default&quot; &quot;cohort_schedule_times&quot;        
## [13] &quot;cohort_schedule_ode_times&quot;     &quot;hyperpar&quot;</code></pre>
<p>and it comes pre-set with the hyper-parameterisation function:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(p$hyperpar, FF16_hyperpar)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p><code>k_I</code> is the light extinction coefficient, <code>disturbance_mean_interval</code> is the mean disturbance interval. The <code>strategy_default</code> member is a Strategy:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(p$strategy_default)</code></pre>
<pre><code>## [1] &quot;FF16_Strategy&quot;</code></pre>
<p>This is the Strategy object that all others will be built from by difference. Running</p>
<pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span><span class="kw">strategy</span>(<span class="kw">trait_matrix</span>(<span class="fl">0.1</span>, <span class="st">&quot;lma&quot;</span>), p)</code></pre>
<p>will create a strategy <code>s</code> where lma is set but also all the parameters that <em>depend</em> on lma.</p>
<p>The function <code>strategy_list</code> can be used to create a list of strategies:</p>
<pre class="sourceCode r"><code class="sourceCode r">lma &lt;-<span class="st"> </span><span class="kw">trait_matrix</span>(<span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dt">length.out=</span><span class="dv">5</span>), <span class="st">&quot;lma&quot;</span>)
<span class="kw">FF16_hyperpar</span>(<span class="kw">trait_matrix</span>(lma, <span class="st">&quot;lma&quot;</span>), s)</code></pre>
<pre><code>##      lma        k_l     r_l
## [1,] 0.1 1.46678341 392.700
## [2,] 0.2 0.44833712 196.350
## [3,] 0.3 0.22412414 130.900
## [4,] 0.4 0.13703875  98.175
## [5,] 0.5 0.09356799  78.540</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ss &lt;-<span class="st"> </span><span class="kw">strategy_list</span>(lma, p)
<span class="kw">length</span>(ss)</code></pre>
<pre><code>## [1] 5</code></pre>
<p>We can then use standard R commands to extract variable from this list</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(ss, function(x) x$lma)</code></pre>
<pre><code>## [1] 0.1 0.2 0.3 0.4 0.5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(ss, function(x) x$k_l)</code></pre>
<pre><code>## [1] 1.46678341 0.44833712 0.22412414 0.13703875 0.09356799</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(ss, function(x) x$a_p1)</code></pre>
<pre><code>## [1] 151.1778 151.1778 151.1778 151.1778 151.1778</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(ss, function(x) x$r_l)</code></pre>
<pre><code>## [1] 392.700 196.350 130.900  98.175  78.540</code></pre>
<p>There’s a convenience function <code>plant_list</code> that returns a set of <em>plants</em> based on a vector of traits:</p>
<pre class="sourceCode r"><code class="sourceCode r">pp &lt;-<span class="st"> </span><span class="kw">plant_list</span>(lma, p)

<span class="kw">sapply</span>(pp, function(p) p$<span class="kw">area_leaf_above</span>(<span class="dv">0</span>))</code></pre>
<pre><code>## [1] 1.713949e-04 1.201090e-04 9.206433e-05 7.449914e-05 6.250239e-05</code></pre>
<p>In addition to the physiological parameters there are large number of “control” parameters that affect the behaviour of the various numerical algorithms used (note that in contrast to the physiological parameters these have a variety of types)</p>
<pre class="sourceCode r"><code class="sourceCode r">p$control</code></pre>
<pre><code>## $plant_assimilation_adaptive
## [1] TRUE
## 
## $plant_assimilation_over_distribution
## [1] FALSE
## 
## $plant_assimilation_tol
## [1] 1e-06
## 
## $plant_assimilation_iterations
## [1] 1000
## 
## $plant_assimilation_rule
## [1] 21
## 
## $plant_seed_tol
## [1] 1e-08
## 
## $plant_seed_iterations
## [1] 1000
## 
## $cohort_gradient_eps
## [1] 1e-06
## 
## $cohort_gradient_direction
## [1] 1
## 
## $cohort_gradient_richardson
## [1] FALSE
## 
## $cohort_gradient_richardson_depth
## [1] 4
## 
## $environment_light_tol
## [1] 1e-06
## 
## $environment_light_nbase
## [1] 17
## 
## $environment_light_max_depth
## [1] 16
## 
## $environment_light_rescale_usually
## [1] FALSE
## 
## $ode_step_size_initial
## [1] 1e-06
## 
## $ode_step_size_min
## [1] 1e-06
## 
## $ode_step_size_max
## [1] 0.1
## 
## $ode_tol_rel
## [1] 1e-06
## 
## $ode_tol_abs
## [1] 1e-06
## 
## $ode_a_y
## [1] 1
## 
## $ode_a_dydt
## [1] 0
## 
## $schedule_nsteps
## [1] 20
## 
## $schedule_eps
## [1] 0.001
## 
## $schedule_verbose
## [1] FALSE
## 
## $schedule_patch_survival
## [1] 6.253026e-05
## 
## $equilibrium_nsteps
## [1] 20
## 
## $equilibrium_eps
## [1] 1e-05
## 
## $equilibrium_large_seed_rain_change
## [1] 10
## 
## $equilibrium_verbose
## [1] TRUE
## 
## $equilibrium_solver_name
## [1] &quot;iteration&quot;
## 
## $equilibrium_extinct_seed_rain
## [1] 0.001
## 
## $equilibrium_nattempts
## [1] 5
## 
## $equilibrium_solver_logN
## [1] TRUE
## 
## $equilibrium_solver_try_keep
## [1] TRUE
## 
## attr(,&quot;class&quot;)
## [1] &quot;Control&quot;</code></pre>
<p>The defaults are rather too slow for many uses, so <code>scm_base_parameters</code> provides a faster set by using <code>fast_control</code> to set many of these to less accurate values.</p>
<pre class="sourceCode r"><code class="sourceCode r">p2 &lt;-<span class="st"> </span><span class="kw">scm_base_parameters</span>()
p2$control[<span class="kw">unlist</span>(p$control) !=<span class="st"> </span><span class="kw">unlist</span>(p2$control)]</code></pre>
<pre><code>## $plant_assimilation_adaptive
## [1] FALSE
## 
## $plant_assimilation_tol
## [1] 1e-04
## 
## $cohort_gradient_direction
## [1] -1
## 
## $environment_light_tol
## [1] 1e-04
## 
## $environment_light_rescale_usually
## [1] TRUE
## 
## $ode_step_size_max
## [1] 5
## 
## $ode_tol_rel
## [1] 1e-04
## 
## $ode_tol_abs
## [1] 1e-04
## 
## $schedule_eps
## [1] 0.005
## 
## $schedule_verbose
## [1] TRUE
## 
## $equilibrium_eps
## [1] 0.001</code></pre>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
